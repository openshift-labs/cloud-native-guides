FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGNsb3VkbmF0aXZlLXdvcmtzaG9wLWFwYgpkZXNjcmlwdGlvbjog\
QVBCIHRvIGRlcGxveSByZXF1aXJlZCBpbmZyYSBjb21wb25lbnRzIGZvciB0aGUgQ2xvdWQtTmF0\
aXZlIFdvcmtzaG9wIG9uIGFuIE9wZW5TaGlmdCBjbHVzdGVyCmJpbmRhYmxlOiBGYWxzZQphc3lu\
Yzogb3B0aW9uYWwKdGFnczoKLSB3b3Jrc2hvcAptZXRhZGF0YToKICBkZXBlbmRlbmNpZXM6IFtd\
CiAgZGlzcGxheU5hbWU6ICJDbG91ZC1OYXRpdmUgV29ya3Nob3AgSW5zdGFsbGVyIgogIGxvbmdE\
ZXNjcmlwdGlvbjogIkluc3RhbGxzIHRoZSBsYWIgaW5zdHJ1Y3Rpb25zIGFuZCByZXF1aXJlZCBj\
b21wb25lbnRzIChHaXQgc2VydmVyLCBOZXh1cywgRWNsaXBzZSBDaGUsIGV0YykgZm9yIHJ1bm5p\
bmcgdGhlIENsb3VkLU5hdGl2ZSBXb3Jrc2hvcCBodHRwczovL2dpdGh1Yi5jb20vb3BlbnNoaWZ0\
LWxhYnMvY2xvdWQtbmF0aXZlLWd1aWRlcyIKICBjb25zb2xlLm9wZW5zaGlmdC5pby9pY29uQ2xh\
c3M6ICJwZmljb24gcGZpY29uLXByb2Nlc3MtYXV0b21hdGlvbiIKICBwcm92aWRlckRpc3BsYXlO\
YW1lOiAiUmVkIEhhdCwgSW5jLiIKcGxhbnM6CiAgLSBuYW1lOiBkZWZhdWx0CiAgICBkZXNjcmlw\
dGlvbjogRGVwbG95cyBDbG91ZC1OYXRpdmUgV29ya3Nob3AgSW5mcmFzdHJ1Y3R1cmUKICAgIGZy\
ZWU6IFRydWUKICAgIG1ldGFkYXRhOgogICAgICBkaXNwbGF5TmFtZTogRGVmYXVsdAogICAgcGFy\
YW1ldGVyczoKICAgIC0gbmFtZTogb3BlbnNoaWZ0X3VzZXIKICAgICAgdGl0bGU6IFVzZXJuYW1l\
CiAgICAgIGRlc2NyaXB0aW9uOiBVc2VyIGlzIHJlcXVpcmVkIGZvciBjcmVhdGluZyBwcm9qZWN0\
IGFkbWluIHJlc291cmNlcwogICAgICB0eXBlOiBzdHJpbmcKICAgICAgcmVxdWlyZWQ6IHRydWUK\
ICAgICAgZGlzcGxheV9ncm91cDogT3BlblNoaWZ0IEFkbWluIFVzZXIKICAgIC0gbmFtZTogb3Bl\
bnNoaWZ0X3Bhc3N3b3JkCiAgICAgIHRpdGxlOiBQYXNzd29yZAogICAgICBkZXNjcmlwdGlvbjog\
UGFzc3dvcmQgaXMgcmVxdWlyZWQgZm9yIGNyZWF0aW5nIHByb2plY3QgYWRtaW4gcmVzb3VyY2Vz\
CiAgICAgIHR5cGU6IHN0cmluZwogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5\
cGU6IHBhc3N3b3JkCiAgICAgIGRpc3BsYXlfZ3JvdXA6IE9wZW5TaGlmdCBBZG1pbiBVc2VyCiAg\
ICAtIG5hbWU6IG9wZW5zaGlmdF9tYXN0ZXJfdXJsCiAgICAgIHRpdGxlOiBPcGVuU2hpZnQgTWFz\
dGVyIFVSTAogICAgICBkZXNjcmlwdGlvbjogVGhlIGFkZHJlc3MgdG8gT3BlblNoaWZ0IG1hc3Rl\
ciBVUkwgdG8gYmUgZGlzcGxheWVkIGluIHRoZSBsYWIgZ3VpZGUgdG8gcGFydGljaXBhbnRzCiAg\
ICAgIHR5cGU6IHN0cmluZwogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5cGU6\
IHN0cmluZwogICAgICBkaXNwbGF5X2dyb3VwOiBMYWIgR3VpZGUKICAgIC0gbmFtZTogb3BlbnNo\
aWZ0X3VzZXJfcGFzc3dvcmQKICAgICAgdGl0bGU6IE9wZW5TaGlmdCBVc2VyIFBhc3N3b3JkCiAg\
ICAgIGRlc2NyaXB0aW9uOiBUaGUgT3BlblNoaWZ0IHBhc3N3b3JkIGZvciBwYXJ0aWNpcGFudHMg\
dG8gYmUgZGlzcGxheWVkIGluIHRoZSBsYWIgZ3VpZGUgdG8gcGFydGljaXBhbnRzCiAgICAgIHR5\
cGU6IHN0cmluZwogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5cGU6IHN0cmlu\
ZwogICAgICB2YWx1ZTogIm9wZW5zaGlmdCIKICAgICAgZGlzcGxheV9ncm91cDogTGFiIEd1aWRl\
CiAgICAtIG5hbWU6IGluZnJhc3Zjc19hZG1fdXNlcgogICAgICB0aXRsZTogSW5mcmEgU2Vydmlj\
ZXMgQWRtaW4gVXNlcgogICAgICBkZXNjcmlwdGlvbjogQWRtaW4gdXNlciBmb3IgaW5mcmFzdHJ1\
Y3R1cmUgc2VydmljZXMgKEdvZ3MsIENoZSwgLi4uKQogICAgICB0eXBlOiBzdHJpbmcKICAgICAg\
ZGVmYXVsdDogImFkbWludXNlciIKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV90\
eXBlOiB0ZXh0CiAgICAgIGRpc3BsYXlfZ3JvdXA6IFdvcmtzaG9wIEluZnJhIFNlcnZpY2VzCiAg\
ICAtIG5hbWU6IGluZnJhc3Zjc19hZG1fcHdkCiAgICAgIHRpdGxlOiBJbmZyYSBTZXJ2aWNlcyBB\
ZG1pbiBQYXNzd29yZAogICAgICBkZXNjcmlwdGlvbjogQWRtaW4gcGFzc3dvcmQgZm9yIGluZnJh\
c3RydWN0dXJlIHNlcnZpY2VzIChHb2dzLCBDaGUsIC4uLikKICAgICAgdHlwZTogc3RyaW5nCiAg\
ICAgIGRlZmF1bHQ6ICJhZG1pbnB3ZCIKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxh\
eV90eXBlOiB0ZXh0CiAgICAgIGRpc3BsYXlfZ3JvdXA6IFdvcmtzaG9wIEluZnJhIFNlcnZpY2Vz"




COPY playbooks /opt/apb/actions
ADD requirements.yml /opt/apb/actions/requirements.yml
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -f
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
